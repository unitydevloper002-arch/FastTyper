<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastTyper IFrameBridge Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 5px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FastTyper IFrameBridge Integration Test</h1>
        
        <div class="status disconnected" id="status">
            Status: Disconnected
        </div>

        <div class="test-section">
            <h3>Test Modes (Auto-Start)</h3>
            <p><strong>New Feature:</strong> Games now automatically start from countdown, bypassing mode selection screens!</p>
            <div class="controls">
                <button onclick="loadAIMode()">AI Mode (Easy)</button>
                <button onclick="loadAIModeHard()">AI Mode (Hard)</button>
                <button onclick="loadMultiplayerMode()">Multiplayer Mode</button>
                <button onclick="loadTestMode()">Test Mode</button>
                <button onclick="clearLog()">Clear Log</button>
            </div>
        </div>

        <div class="test-section">
            <h3>Platform Controls</h3>
            <div class="controls">
                <button onclick="pauseGame()">Pause Game</button>
                <button onclick="resumeGame()">Resume Game</button>
                <button onclick="simulateTimeout()">Simulate Timeout</button>
                <button onclick="simulateConnectionLoss()">Simulate Connection Loss</button>
                <button onclick="loadReplay()">Load Replay</button>
            </div>
        </div>

        <div class="iframe-container">
            <iframe id="gameFrame" src="about:blank"></iframe>
        </div>

        <div class="test-section">
            <h3>Communication Log</h3>
            <div class="log" id="log"></div>
        </div>
    </div>

    <script>
        let gameFrame = document.getElementById('gameFrame');
        let logElement = document.getElementById('log');
        let statusElement = document.getElementById('status');
        let isConnected = false;

        // Listen for messages from the game
        window.addEventListener('message', function(event) {
            logMessage('Received: ' + JSON.stringify(event.data, null, 2));
            
            if (event.data && event.data.type === 'game_ready') {
                isConnected = true;
                updateStatus();
                logMessage('‚úÖ Game is ready!');
            }
            
            if (event.data && event.data.type === 'build_version') {
                logMessage('üì¶ Build version: ' + event.data.payload.version);
            }
            
            if (event.data && event.data.type === 'match_result') {
                logMessage('üèÜ Match Result: ' + event.data.payload.outcome + ' (Score: ' + event.data.payload.score + ')');
            }
            
            if (event.data && event.data.type === 'match_abort') {
                logMessage('‚ùå Match Aborted: ' + event.data.payload.message);
            }
            
            if (event.data && event.data.type === 'game_state') {
                logMessage('üéÆ Game State: ' + event.data.payload.state);
            }
        });

        function logMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus() {
            if (isConnected) {
                statusElement.textContent = 'Status: Connected';
                statusElement.className = 'status connected';
            } else {
                statusElement.textContent = 'Status: Disconnected';
                statusElement.className = 'status disconnected';
            }
        }

        function loadAIMode() {
            const url = 'http://localhost:8080/index.html?matchId=ai_test_001&playerId=human_player&opponentId=a912345678';
            gameFrame.src = url;
            isConnected = false;
            updateStatus();
            logMessage('üéØ Loading AI Mode (Easy)...');
        }

        function loadAIModeHard() {
            const url = 'http://localhost:8080/index.html?matchId=ai_test_002&playerId=human_player&opponentId=b912345678';
            gameFrame.src = url;
            isConnected = false;
            updateStatus();
            logMessage('üéØ Loading AI Mode (Hard)...');
        }

        function loadMultiplayerMode() {
            const url = 'http://localhost:8080/index.html?matchId=multi_test_001&playerId=player1&opponentId=player2';
            gameFrame.src = url;
            isConnected = false;
            updateStatus();
            logMessage('üåê Loading Multiplayer Mode...');
        }

        function loadTestMode() {
            const url = 'http://localhost:8080/index.html?testMode=ai';
            gameFrame.src = url;
            isConnected = false;
            updateStatus();
            logMessage('üß™ Loading Test Mode...');
        }

        function pauseGame() {
            if (isConnected) {
                gameFrame.contentWindow.postMessage({
                    type: 'pause_game',
                    payload: {}
                }, '*');
                logMessage('‚è∏Ô∏è Pausing game...');
            } else {
                logMessage('‚ùå Game not connected');
            }
        }

        function resumeGame() {
            if (isConnected) {
                gameFrame.contentWindow.postMessage({
                    type: 'resume_game',
                    payload: {}
                }, '*');
                logMessage('‚ñ∂Ô∏è Resuming game...');
            } else {
                logMessage('‚ùå Game not connected');
            }
        }

        function simulateTimeout() {
            if (isConnected) {
                gameFrame.contentWindow.postMessage({
                    type: 'player_timeout',
                    payload: {
                        playerId: 'opponent_player'
                    }
                }, '*');
                logMessage('‚è∞ Simulating player timeout...');
            } else {
                logMessage('‚ùå Game not connected');
            }
        }

        function simulateConnectionLoss() {
            if (isConnected) {
                gameFrame.contentWindow.postMessage({
                    type: 'connection_lost',
                    payload: {}
                }, '*');
                logMessage('üì° Simulating connection loss...');
            } else {
                logMessage('‚ùå Game not connected');
            }
        }

        function loadReplay() {
            if (isConnected) {
                const replayData = {
                    states: [
                        '{"type":"game_start","timestamp":1234567890}',
                        '{"type":"word_typed","word":"hello","timestamp":1234567891}',
                        '{"type":"word_typed","word":"world","timestamp":1234567892}',
                        '{"type":"game_end","score":100,"timestamp":1234567893}'
                    ]
                };
                
                gameFrame.contentWindow.postMessage({
                    type: 'load_replay',
                    payload: replayData
                }, '*');
                logMessage('üì∫ Loading replay data...');
            } else {
                logMessage('‚ùå Game not connected');
            }
        }

        function clearLog() {
            logElement.innerHTML = '';
            logMessage('üóëÔ∏è Log cleared');
        }

        // Initialize
        logMessage('üöÄ FastTyper IFrameBridge Test Page Loaded');
        logMessage('üí° Click a test mode button to start testing');
    </script>
</body>
</html>
